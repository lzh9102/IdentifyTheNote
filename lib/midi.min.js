// https://github.com/mudcube/MIDI.js/
!function(){var e="undefined"!=typeof exports?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var o,r,i=0,a=t,s="";e.charAt(0|i)||(a="=",i%1);s+=a.charAt(63&o>>8-i%1*8)){if((r=e.charCodeAt(i+=.75))>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|r}return s}),e.atob||(e.atob=function(e){if((e=e.replace(/=+$/,"")).length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,r,i=0,a=0,s="";r=e.charAt(a++);~r&&(o=i%4?64*o+r:r,i++%4)?s+=String.fromCharCode(255&o>>(-2*i&6)):0)r=t.indexOf(r);return s})}();var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n,o,r,i,a,s,u,c=this._keyStr.indexOf(e.charAt(e.length-1)),l=this._keyStr.indexOf(e.charAt(e.length-1)),d=Math.ceil(3*e.length/4);64==c&&d--,64==l&&d--;var f=0,p=0;for(n=t?new Uint8Array(t):new Uint8Array(d),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),f=0;f<d;f+=3)o=this._keyStr.indexOf(e.charAt(p++))<<2|(a=this._keyStr.indexOf(e.charAt(p++)))>>4,r=(15&a)<<4|(s=this._keyStr.indexOf(e.charAt(p++)))>>2,i=(3&s)<<6|(u=this._keyStr.indexOf(e.charAt(p++))),n[f]=o,64!=s&&(n[f+1]=r),64!=u&&(n[f+2]=i);return n}};if(window.AudioContext=window.AudioContext||window.webkitAudioContext||null,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext||null,function(e){var t,n,o,r=function(e){return"[object Function]"===Object.prototype.toString.call(e)||"[object AudioContextConstructor]"===Object.prototype.toString.call(e)};r(e)&&(n=new e).destination&&n.sampleRate&&(t=e.prototype,o=Object.getPrototypeOf(n.createBufferSource()),r(o.start)||r(o.noteOn)&&(o.start=function(e,t,n){switch(arguments.length){case 0:throw new Error("Not enough arguments.");case 1:this.noteOn(e);break;case 2:if(!this.buffer)throw new Error("Missing AudioBuffer");this.noteGrainOn(e,t,this.buffer.duration-t);break;case 3:this.noteGrainOn(e,t,n)}}),r(o.noteOn)||(o.noteOn=o.start),r(o.noteGrainOn)||(o.noteGrainOn=o.start),r(o.stop)||(o.stop=o.noteOff),r(o.noteOff)||(o.noteOff=o.stop),[["createGainNode","createGain"],["createDelayNode","createDelay"],["createJavaScriptNode","createScriptProcessor"]].forEach(function(e){for(var t,n;e.length;)t=e.pop(),r(this[t])?this[e.pop()]=this[t]:(n=e.pop(),this[t]=this[n])},t))}(window.AudioContext),"undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var t={},n=0;function o(e){n++;var o=document.body,r=new Audio,i=e.split(";")[0];r.id="audio",r.setAttribute("preload","auto"),r.setAttribute("audiobuffer",!0),r.addEventListener("error",function(){o.removeChild(r),t[i]=!1,n--},!1),r.addEventListener("canplaythrough",function(){o.removeChild(r),t[i]=!0,n--},!1),r.src="data:"+e,o.appendChild(r)}e.audioDetect=function(e){if(navigator.requestMIDIAccess)if(-1!==Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))t.webmidi=!0;else for(var r=0;navigator.plugins.length>r;r++){navigator.plugins[r].name.indexOf("Jazz-Plugin")>=0&&(t.webmidi=!0)}if("undefined"!=typeof Audio){t.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(t.webaudio=!0);var i=new Audio;if(i.canPlayType){var a=i.canPlayType('audio/ogg; codecs="vorbis"');a="probably"===a||"maybe"===a;var s=i.canPlayType("audio/mpeg");if(s="probably"===s||"maybe"===s,a||s){a&&o("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),s&&o("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var u=Date.now(),c=setInterval(function(){var o=Date.now()-u>5e3;n&&!o||(clearInterval(c),e(t))},1)}else e(t)}else e(t)}else e(t)}}(MIDI),function(e){"use strict";function t(e){return e.replace(/[^a-z0-9_ ]/gi,"").replace(/[ ]/g,"_").toLowerCase()}var n=function(e){var n={},o=n.byCategory={},r=n.byId={},i=n.byName={};for(var a in e)for(var s=e[a],u=0,c=s.length;u<c;u++){var l=s[u];if(l){var d=parseInt(l.substr(0,l.indexOf(" ")),10),f=l.replace(d+" ",""),p=t(f),A=t(a),g={id:p,name:f,program:--d,category:a};r[d]=g,i[p]=g,o[A]=o[A]||[],o[A].push(g)}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]});function o(e,t){var n=i[t];if(n)return n[e]}function r(t,n,o,r){var s=i[n];if(s){r?setTimeout(function(){s[t]=o},r):s[t]=o;var u=e.messageHandler[t]||a[t];u&&u(n,o,r)}}n.getProgramSpec=function(o){var r;if(r="string"==typeof o?n.byName[t(o)]:n.byId[o])return r;e.handleError("invalid program",arguments)},e.getProgram=function(e){return o("program",e)},e.programChange=function(e,t,o){var i=n.getProgramSpec(t);i&&isFinite(t=i.program)&&r("program",e,t,o)},e.getMono=function(e){return o("mono",e)},e.setMono=function(e,t,n){isFinite(t)&&r("mono",e,t,n)},e.getOmni=function(e){return o("omni",e)},e.setOmni=function(e,t,n){isFinite(t)&&r("omni",e,t,n)},e.getSolo=function(e){return o("solo",e)},e.setSolo=function(e,t,n){isFinite(t)&&r("solo",e,t,n)};var i=function(){for(var e={},t=0;t<=15;t++)e[t]={number:t,program:t,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}();e.keyToNote={},e.noteToKey={},function(){for(var t=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],n=21;n<=108;n++){var o=t[n%12]+((n-12)/12>>0);e.keyToNote[o]=n,e.noteToKey[n]=o}}(),e.channels=i,e.GM=n,e.messageHandler={};var a={program:function(t,n,o){e.__api&&(e.player.isPlaying?(e.player.pause(),e.loadProgram(n,e.player.play)):e.loadProgram(n))}};e.handleError=function(e,t){console&&console.error&&console.error(e,t)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.player=MIDI.player||{},function(e){"use strict";"undefined"!=typeof console&&console.log&&console.log("%c♥ MIDI.js 0.4.2 ♥","color: red;"),e.DEBUG=!0,e.USE_XHR=!0,e.soundfontUrl="./soundfont/",e.loadPlugin=function(n,o,r,i){function a(o){var r=location.hash,i="";if(o[n.api]?i=n.api:o[r.substr(1)]?i=r.substr(1):o.webmidi?i="webmidi":window.AudioContext?i="webaudio":window.Audio&&(i="audiotag"),t[i]){if(n.audioFormat)var a=n.audioFormat;else a=o["audio/ogg"]?"ogg":"mp3";e.__api=i,e.__audioFormat=a,e.supports=o,e.loadProgram(n)}}"function"==typeof n&&(n={onsuccess:n}),(n=n||{}).api=n.api||e.__api,n.soundfontUrl&&(e.soundfontUrl=n.soundfontUrl),e.supports?a(e.supports):e.audioDetect(a)},e.loadProgram=function(){return function(n,o,r,i){"object"!=typeof(n=n||{})&&(n={instrument:n}),r&&(n.onerror=r),i&&(n.onprogress=i),o&&(n.onsuccess=o),n.format=e.__audioFormat,n.instruments=function(t){var n=t.instruments||t.instrument||e.channels[0].program;"object"!=typeof n&&(n=void 0===n?[]:[n]);for(var o=0;o<n.length;o++){var r=n[o];r===+r&&e.GM.byId[r]&&(n[o]=e.GM.byId[r].id)}return n}(n),t[e.__api](n)}}();var t={webmidi:function(t){e.WebMIDI.connect(t)},audiotag:function(e){n(e,"AudioTag")},webaudio:function(e){n(e,"WebAudio")}};function n(t,n){var r=t.format,i=t.instruments,a=t.onprogress,s=t.onerror,u=i.length,c=u;function l(){a&&a("load",1),e[n].connect(t)}if(u)for(var d=0;d<u;d++){var f=i[d];e.Soundfont[f]?!--c&&l():o(i[d],r,function(e,t){a&&a("load",t/u+(u-c)/u,f)},function(){!--c&&l()},s)}else l()}function o(t,n,o,r,i){var a=e.soundfontUrl+t+"-"+n+".js";e.USE_XHR?galactic.util.request({url:a,format:"text",onerror:i,onprogress:o,onsuccess:function(e,t){var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,document.body.appendChild(n),r()}}):dom.loadScript.add({url:a,verify:'MIDI.Soundfont["'+t+'"]',onerror:i,onsuccess:function(){r()}})}e.setDefaultPlugin=function(t){for(var n in t)e[n]=t[n]}}(MIDI),function(e){"use strict";window.Audio&&function(){for(var t=e.AudioTag={api:"audiotag"},n={},o=127,r=-1,i=[],a=[],s={},u=0;u<12;u++)i[u]=new Audio;function c(t,n){if(e.channels[t]){var u=e.channels[t].program,c=e.GM.byId[u].id;if(n=s[n]){var l=c+""+n.id,d=(r+1)%i.length,f=i[d];if(a[d]=l,!e.Soundfont[c])return void(e.DEBUG&&console.log("404",c));f.src=e.Soundfont[c][n.id],f.volume=o/127,f.play(),r=d}}}function l(t,n){if(e.channels[t]){var o=e.channels[t].program,u=e.GM.byId[o].id;if(n=s[n])for(var c=u+""+n.id,l=0,d=i.length;l<d;l++){var f=(l+r+1)%d,p=a[f];if(p&&p==c)return i[f].pause(),void(a[f]=null)}}}t.audioBuffers=i,t.messageHandler={},t.send=function(e,t){},t.setController=function(e,t,n,o){},t.setVolume=function(e,t){o=t},t.pitchBend=function(e,t,n){},t.noteOn=function(e,t,o,r){var i=n[t];if(s[i]){if(r)return setTimeout(function(){c(e,i)},1e3*r);c(e,i)}},t.noteOff=function(e,t,n){},t.chordOn=function(e,t,o,r){for(var i=0;i<t.length;i++){var a=t[i],u=n[a];if(s[u]){if(r)return setTimeout(function(){c(e,u)},1e3*r);c(e,u)}}},t.chordOff=function(e,t,o){for(var r=0;r<t.length;r++){var i=t[r],a=n[i];if(s[a]){if(o)return setTimeout(function(){l(e,a)},1e3*o);l(e,a)}}},t.stopAllNotes=function(){for(var e=0,t=i.length;e<t;e++)i[e].pause()},t.connect=function(o){for(var r in e.setDefaultPlugin(t),e.keyToNote)n[e.keyToNote[r]]=r,s[r]={id:r};o.onsuccess&&o.onsuccess()}}()}(MIDI),function(e){"use strict";window.AudioContext&&function(){var t,n=!1,o=e.WebAudio={api:"webaudio"},r={},i={},a=127,s={};o.audioBuffers=s,o.messageHandler={},o.send=function(e,t){},o.setController=function(e,t,n,o){},o.setVolume=function(e,t,n){n?setTimeout(function(){a=t},1e3*n):a=t},o.pitchBend=function(t,n,o){var r=e.channels[t];r&&(o?setTimeout(function(){r.pitchBend=n},o):r.pitchBend=n)},o.noteOn=function(o,u,c,l){l=l||0;var d=e.channels[o].program,f=s[d+"x"+u];if(f){if(l<t.currentTime&&(l+=t.currentTime),n)var p=t.createMediaElementSource(f);else(p=t.createBufferSource()).buffer=f;if(i){var A=p;for(var g in i)A.connect(i[g].input),A=i[g]}var m=c/127*(a/127)*2-1;if(p.connect(t.destination),p.playbackRate.value=1,p.gainNode=t.createGain(),p.gainNode.connect(t.destination),p.gainNode.gain.value=Math.min(1,Math.max(-1,m)),p.connect(p.gainNode),n){if(l)return setTimeout(function(){f.currentTime=0,f.play()},1e3*l);f.currentTime=0,f.play()}else p.start(l||0);return r[o+"x"+u]=p,p}e.handleError("no buffer",arguments)},o.noteOff=function(o,i,a){a=a||0;var u=e.channels[o].program,c=s[u+"x"+i];if(c){a<t.currentTime&&(a+=t.currentTime);var l=r[o+"x"+i];if(l){if(l.gainNode){var d=l.gainNode.gain;d.linearRampToValueAtTime(d.value,a),d.linearRampToValueAtTime(-1,a+.3)}return n?a?setTimeout(function(){c.pause()},1e3*a):c.pause():l.noteOff?l.noteOff(a+.5):l.stop(a+.5),delete r[o+"x"+i],l}}},o.chordOn=function(e,t,n,r){for(var i,a={},s=0,u=t.length;s<u;s++)a[i=t[s]]=o.noteOn(e,i,n,r);return a},o.chordOff=function(e,t,n){for(var r,i={},a=0,s=t.length;a<s;a++)i[r=t[a]]=o.noteOff(e,r,n);return i},o.stopAllNotes=function(){for(var e in r){var n=0;n<t.currentTime&&(n+=t.currentTime);var o=r[e];o.gain.linearRampToValueAtTime(1,n),o.gain.linearRampToValueAtTime(0,n+.3),o.noteOff?o.noteOff(n+.3):o.stop(n+.3),delete r[e]}},o.setEffects=function(n){if(t.tunajs)for(var o=0;o<n.length;o++){var r=n[o],a=new t.tunajs[r.type](r);a.connect(t.destination),i[r.type]=a}else e.handleError("effects not installed.",arguments)},o.connect=function(n){e.setDefaultPlugin(o),o.setContext(t||new(window.AudioContext||window.webkitAudioContext),n.onsuccess)},o.getContext=function(){return t},o.setContext=function(o,r,i,a){t=o,"undefined"!=typeof Tuna&&(t.tunajs instanceof Tuna||(t.tunajs=new Tuna(t)));var u=[],c=e.keyToNote;for(var l in c)u.push(l);function d(e){for(var t in p)if(p[t])return;r&&(r(),r=null)}function f(o,r,i,a){var u=o[a];u&&(p[r]++,function(e,o,r){if(n){var i=new Audio;i.src=e,i.controls=!1,i.autoplay=!1,i.preload=!1,i.addEventListener("canplay",function(){o&&o(i)}),i.addEventListener("error",function(e){r&&r(e)}),document.body.appendChild(i)}else if(0===e.indexOf("data:audio")){var a=e.split(",")[1],s=Base64Binary.decodeArrayBuffer(a);t.decodeAudioData(s,o,r)}else{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=function(){t.decodeAudioData(u.response,o,r)},u.send()}}(u,function(t){t.id=a;var n=e.keyToNote[a];if(s[r+"x"+n]=t,0==--p[r]){o.isLoaded=!0,e.DEBUG&&console.log("loaded: ",g),d()}},function(){e.handleError("audio could not load",arguments)}))}var p={},A=e.Soundfont;for(var g in A){var m=A[g];if(!m.isLoaded){var q=e.GM.byName[g];if(q){var h=q.program;p[h]=0;for(var v=0;v<u.length;v++){f(m,h,0,l=u[v])}}}}setTimeout(d,1)}}()}(MIDI),function(e){"use strict";var t=null,n=e.WebMIDI={api:"webmidi"};n.messageHandler={},n.messageHandler.program=function(e,n,o){t.send([192+e,n],1e3*o)},n.send=function(e,n){t.send(e,1e3*n)},n.setController=function(e,n,o,r){t.send([e,n,o],1e3*r)},n.setVolume=function(e,n,o){t.send([176+e,7,n],1e3*o)},n.pitchBend=function(e,n,o){t.send([224+e,n],1e3*o)},n.noteOn=function(e,n,o,r){t.send([144+e,n,o],1e3*r)},n.noteOff=function(e,n,o){t.send([128+e,n,0],1e3*o)},n.chordOn=function(e,n,o,r){for(var i=0;i<n.length;i++){var a=n[i];t.send([144+e,a,o],1e3*r)}},n.chordOff=function(e,n,o){for(var r=0;r<n.length;r++){var i=n[r];t.send([128+e,i,0],1e3*o)}},n.stopAllNotes=function(){t.cancel();for(var e=0;e<16;e++)t.send([176+e,123,0])},n.connect=function(o){var r=o.onsuccess,i=o.onerror;e.setDefaultPlugin(n),navigator.requestMIDIAccess().then(function(n){var a=n.outputs;void 0===(t="function"==typeof a?a()[0]:a[0])?function(t){if(i&&i(t),window.AudioContext)o.api="webaudio";else{if(!window.Audio)return;o.api="audiotag"}e.loadPlugin(o)}():r&&r()},i)}}(MIDI),"undefined"==typeof galactic&&(galactic={}),function(e){if((e.util||(e.util={})).request=function(n,o,r,i){"use strict";"string"==typeof n&&(n={url:n});var a=n.data,s=n.url,u=n.method||(n.data?"POST":"GET"),c=n.format,l=n.headers,d=n.responseType,f=n.withCredentials||!1;i=i||n.onprogress,o=o||n.onsuccess,r=r||n.onerror;if(void 0===t||!e.loc.isLocalUrl(s)){var p=new XMLHttpRequest;if(p.open(u,s,!0),l)for(var A in l)p.setRequestHeader(A,l[A]);else a&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded");return d&&(p.responseType=d),f&&(p.withCredentials=!0),r&&"onerror"in p&&(p.onerror=r),i&&p.upload&&"onprogress"in p.upload&&(a?p.upload.onprogress=function(e){i.call(p,e,event.loaded/event.total)}:p.addEventListener("progress",function(e){var t=0;if(e.lengthComputable)t=e.total;else if(p.totalBytes)t=p.totalBytes;else{var n=parseInt(p.getResponseHeader("Content-Length-Raw"));if(!isFinite(n))return;p.totalBytes=t=n}i.call(p,e,e.loaded/t)})),p.onreadystatechange=function(t){if(4===p.readyState)if(200===p.status||304===p.status||308===p.status||0===p.status&&e.client.cordova){if(o){var n;if("json"===c)try{n=JSON.parse(t.target.response)}catch(e){r&&r.call(p,t)}else n="xml"===c?t.target.responseXML:"text"===c?t.target.responseText:t.target.response;o.call(p,t,n)}}else r&&r.call(p,t)},p.send(a),p}t.readFile(s,"utf8",function(e,t){e?r&&r(e):o&&o({responseText:t})})},"undefined"!=typeof module&&module.exports){var t=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=e.util.request}}(galactic),void 0===dom)var dom={};!function(){"use strict";function e(e,t){try{for(var n=(e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".")).split("."),o=n.length,r=t||window,i=0;i<o;i++){var a=n[i];if(null==r[a])return!1;r=r[a]}return!0}catch(e){return!1}}dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(t){var n=this;"string"==typeof t&&(t={url:t});var o=t.urls;void 0===o&&(o=[{url:t.url,verify:t.verify}]);var r=document.getElementsByTagName("head")[0],i=function(t,o){n.loaded[t.url]||o&&!1===e(o)||(n.loaded[t.url]=!0,n.loading[t.url]&&n.loading[t.url](),delete n.loading[t.url],t.onsuccess&&t.onsuccess(),void 0!==f&&f())},a=!1,s=[],u=function(e){if("string"==typeof e&&(e={url:e,verify:t.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var o=e.test=e.verify;if("object"==typeof o)for(var u=0;u<o.length;u++)s.push(o[u]);else s.push(o)}if(!n.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||i(e)},l.onload=function(){i(e)},l.onerror=function(){if(a=!0,delete n.loading[e.url],"object"==typeof e.test)for(var t in e.test)c(e.test[t]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),r.appendChild(l),n.loading[e.url]=function(){}}},c=function(e){for(var t=[],n=0;n<s.length;n++)s[n]!==e&&t.push(s[n]);s=t},l=function(n){if(n)i(n,n.test);else for(var r=0;r<o.length;r++)i(o[r],o[r].test);var u=!0;for(r=0;r<s.length;r++)!1===e(s[r])&&(u=!1);!t.strictOrder&&u?a?t.error&&t.error():t.onsuccess&&t.onsuccess():setTimeout(function(){l(n)},10)};if(t.strictOrder){var d=-1,f=function(){if(o[++d]){var e=o[d],r=e.url;n.loading[r]?n.loading[r]=function(){e.onsuccess&&e.onsuccess(),f()}:n.loaded[r]?f():(u(e),l(e))}else a?t.error&&t.error():t.onsuccess&&t.onsuccess()};f()}else for(d=0;d<o.length;d++)u(o[d]),l(o[d])},dom.loadScript=new dom.loadScript}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript);
